# 云巴产品计费规则

本文针对云巴官方网站的价格页面作补充说明。

## 计费规则

应用自创建开始，每 30 个自然日会进行一次结算。结算时，会根据用户的实际使用情况自动匹配合适的套餐，如达到付费套餐的标准，会进行扣费。如果用户未按时缴清欠款，会影响后续的使用。详见下方说明。


### 计费规则

- 应用自创建开始，每 30 个自然日进行一次结算，并自动生成账单。每次结算时，按照前 30 天“日活”的峰值，决定所对应的套餐档。
- 确定套餐后，再根据该套餐的限额判断“消息量”和“频道数量”是否超额。

>费用 = “日活”峰值对应的套餐费用 + 消息量、频道数量超额费用

### 欠费处理

- 结算日生成账单后，如果存在欠费，应用还可以正常使用 20 天，之后会进入免费受限状态（免费受限状态：仅可享受免费套餐，超过免费日活限制的那部分客户端无法连接云巴服务器），该状态下再过三个月不支付就会注销应用。

- 日活超过基础版最高套餐时，用户需要联系商务开通专业版，如未开通，用户可以正常使用 30 天，此后会进入套餐内受限状态（套餐内受限状态：可以正常使用现有套餐，超出套餐日活限制的客户端无法连接云巴服务器）。


## 计费举例

### 扣费日期举例

某用户在 2016/12/27 当天选购了某套餐并付款。30 天后，即在第 31 天（2017/1/26）时，会生成 2016/12/27 - 2017/1/25 的账单，包括当月日活所对应的套餐费用，消息量、频道超出部分的费用。

### 套餐扣费举例

A 用户的应用在第 31 天结算时，
- 实际日活在 249 元的基础 A 档次，则结算时会按照 249 元计费；
- 实际消息量为 1230 万条，按照基础 A 的标准（500 万条）超出了 730 万条，按照每超出 100 万条需要多收 5 元计算，结算时需要另外支付 40 元；
- 实际频道数量用了 100 个，按照基础 A 的标准（1500 个），未超出限额，不会产生额外费用；

因此，A 用户在第 31 天结算时，其账户需缴费用为：249 + 40 = 289 元。

### 欠费处理举例

日活为 4000（基础 B）的某应用，在结算日过后欠费了 20 天，就会变为免费受限状态，此后，该应用的日活会被限制在 100 以内，超出部分的客户端将无法连接云巴服务器。又过了 3 个月，用户仍未缴清欠费，则其应用会被注销。

## 名词解释

- 月：按照 30 个自然日计算。例如 用户 2016 年 12 月 27 日购买套餐，其套餐扣费是从 2016 年 12 月 27 日往后加 30 天来计算的。
- 日活：日活跃用户数。一段时间内的活跃用户数是指该时间段内进行过上线操作的用户数量（不一定持续在线）。结算时，计算的是 30 天内，活跃用户最多的一天的活跃用户数量。
- 日活超额：在用户的使用期间，日活超出当前套餐限额的次数超过两次或者至少有一次超额了 10% 则认为该应用当月的日活超额。
- 消息量：按云巴服务器发出的消息来计算，qos 0：算 0.5 条，qos 1、2：算 1 条。
- 权限管理：提供 App、Topic、Token 三个层级的权限控制权。详见官方文档。
- 第三方推送：集成了小米、华为推送，实现了在应用被杀的情况下，也能收到通知，引导用户打开应用。同时，支持自动创建小米、华为应用。
- 在线用户数量统计：对一段时间内持续在线的用户的数量进行统计。
- 活跃用户数量统计：对一段时间内连接过云巴服务器的用户数量（不一定持续在线）进行统计。
- 加密链接：支持 https。使用 SSL/TLS 方式进行连接，则 port 为 443；否则，port 为 3000。
- 送达确认：当第一个目标用户（且不是消息发布者）收到消息并向服务器回复了 puback 后，服务器给消息发布者发送一个 recvack。借助这个通知，消息发布者可以了解第一个收到消息的用户的 alias 和 时间戳。
- IP 固定：云巴服务的 IP 是不固定的。开通这项功能，我们可以提供 Broker 的地址和端口。
- 性能优化：包括存储优化、架构调优、网络链路优化等。
- 跨机房数据备份：按机房数量额外收费，具体内容请联系商务咨询。
- 99.999% 可用 SLA：开通“跨机房数据备份”服务，且使用三个机房或以上，即可支持此项服务，具体报价请联系商务。SLA，即 Service-level Agreement。99.999% 可用 SLA 具体的宕机时间可参考：https://uptime.is/99.999

 